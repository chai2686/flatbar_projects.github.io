<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>HTML5 Driving Navigation</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
html, body {
  height: 100%;
  margin: 0;
}
#map {
  height: 100%;
}
#panel {
  position: absolute;
  bottom: 0;
  width: 100%;
  background: white;
  padding: 10px;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.3);
  font-family: sans-serif;
}
#steps {
  max-height: 120px;
  overflow-y: auto;
  font-size: 14px;
}
button {
  width: 100%;
  padding: 10px;
  font-size: 16px;
}
</style>
</head>

<body>

<div id="map"></div>

<div id="panel">
  <button onclick="startNavigation()">â–¶ Start Navigation</button>
  <div id="steps"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('map').setView([13.7563, 100.5018], 14);

// Map tiles
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

let startMarker, endMarker, routeLine;
let routeSteps = [];
let userMarker;

// Tap to set start / destination
map.on('click', e => {
  if (!startMarker) {
    startMarker = L.marker(e.latlng).addTo(map).bindPopup("START").openPopup();
  } else if (!endMarker) {
    endMarker = L.marker(e.latlng).addTo(map).bindPopup("DESTINATION").openPopup();
    loadRoute();
  }
});

// Get route from OSRM
function loadRoute() {
  const s = startMarker.getLatLng();
  const d = endMarker.getLatLng();

  const url = `https://router.project-osrm.org/route/v1/driving/`
    + `${s.lng},${s.lat};${d.lng},${d.lat}`
    + `?steps=true&overview=full&geometries=geojson`;

  fetch(url)
    .then(r => r.json())
    .then(data => {
      const route = data.routes[0];
      routeSteps = route.legs[0].steps;

      const coords = route.geometry.coordinates.map(c => [c[1], c[0]]);
      routeLine = L.polyline(coords, { color: 'blue', weight: 6 }).addTo(map);
      map.fitBounds(routeLine.getBounds());

      showSteps();
    });
}

// Show turn-by-turn instructions
function showSteps() {
  const stepsDiv = document.getElementById("steps");
  stepsDiv.innerHTML = "<b>Directions:</b><br>";

  routeSteps.forEach((s, i) => {
    stepsDiv.innerHTML += `${i+1}. ${s.maneuver.instruction}<br>`;
  });
}

// Start navigation (follow GPS)
function startNavigation() {
  map.locate({ watch: true, enableHighAccuracy: true });
}

// Live GPS tracking
map.on('locationfound', e => {
  if (!userMarker) {
    userMarker = L.circleMarker(e.latlng, {
      radius: 8,
      color: 'green'
    }).addTo(map).bindPopup("YOU");
  } else {
    userMarker.setLatLng(e.latlng);
  }

  // Auto center map while driving
  map.setView(e.latlng, 17);
});

map.on('locationerror', () => {
  alert("GPS permission required");
});
</script>

</body>
</html>
