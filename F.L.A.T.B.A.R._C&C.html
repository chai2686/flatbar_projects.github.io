<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="เว็บแอพผู้ช่วยงานคำสั่งเสียง"><meta name="Version" content="2.0 Beta"><link rel="icon" href="FLATBAR_AI.ico" type="image/x-icon"><link rel="icon" href="FLATBAR_AI.png" type="image/png"><title>F.L.A.T.B.A.R.</title><style>@import url(https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap);:root{--primary-bg:#0a0f1e;--primary-text:#e0e0e0;--accent-color:#00ffff;--glow-color:rgba(0, 255, 255, 0.7);--secondary-color:#ff00ff;--tertiary-color:#ffff00}body{background-color:var(--primary-bg);color:var(--primary-text);font-family:'ADLaM Display',sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;overflow:hidden}.container{width:100%;max-width:480px;height:90%;display:flex;flex-direction:column;justify-content:space-between;padding:20px;box-sizing:border-box}.footer,.header{text-align:center}.main-content{flex-grow:1;display:flex;justify-content:center;align-items:center}#orb{width:150px;height:150px;cursor:pointer;animation:pulse 4s infinite}#orb:hover{transform:scale(1.1)}@keyframes pulse{0%{transform:scale(.95)}70%{transform:scale(1);box-shadow:0 0 0 10px rgba(0,255,255,0)}100%{transform:scale(.95);box-shadow:0 0 0 0 rgba(0,255,255,0)}}.card{max-height:60vh;overflow-y:auto;scroll-behavior:smooth;background:rgba(0,255,255,.1);border:1px solid var(--accent-color);border-radius:10px;padding:20px;margin-top:20px;display:none}.card h3{margin-top:0;color:var(--accent-color)}.confirmbutton{display:none;text-align:end}.button{font-size:18px;background:rgba(0,255,255,.1);border:1px solid var(--accent-color);border-radius:10px;position:relative;padding-left:10px;padding-right:10px}.footer{margin-top:20px}td{font-size:14px}.version{font-size:12px;display:flex;flex-direction:row-reverse}</style></head><body><div class="container"><header class="header"><h1>F.L.A.T.B.A.R</h1></header><div class="main-content"><img id="orb" src="walkie-talkie.png" alt="walkie-talkie"></div><div id="info-card" class="card"><h3 id="card-title"></h3><p id="card-content"></p><br><br><table id="dataTable" style="display:none"><thead><tr><th>ไซส์</th><th>แบชท์</th><th>จำนวน</th><th>ลูกค้า</th></tr></thead><tbody></tbody></table></div><div id="inputcard" class="card"><h3 id="inputcard-title"></h3><p id="inputcard-content"></p><div id="confirmbutton" class="confirmbutton"><button type="button" class="button" id="savebutton" style="color:#32cd32">บันทึก</button><button type="button" class="button" id="cancelbutton" style="color:red">ยกเลิก</button></div><br><br></div><footer class="footer"><p id="status">กดที่วิทยุเพื่อพูด...</p></footer><footer><p class="version">Version 2.1 Beta</p></footer></div><script>let selectedVoice=null;speechSynthesis.onvoiceschanged=()=>{var e=speechSynthesis.getVoices();selectedVoice=(selectedVoice=e.find(e=>"th-TH"===e.lang&&e.name.toLowerCase().includes("male")))||e.find(e=>"th-TH"===e.lang)};const orb=document.getElementById("orb"),status=document.getElementById("status"),infoCard=document.getElementById("info-card"),cardTitle=document.getElementById("card-title"),cardContent=document.getElementById("card-content"),inputCard=document.getElementById("inputcard"),inputCardContent=document.getElementById("inputcard-content");let userInput="",textInput="",recognition,isListening=!1;if("webkitSpeechRecognition"in window){recognition=new webkitSpeechRecognition,grammarlist=new webkitSpeechGrammarList;const grammarsize="#JSGF V1.0; grammar size; public <size> = มิล หน้า | หน้า | ยาว | ความยาว | ไซส์ | กิโล | น้ำหนัก | จำนวน | เส้น | เอาใหม่ | ยกเลิก | เหล็กแบน | คือใคร | เป็นใคร | รถลูกค้า | รถร่วม | รถบริษัท | ใช้ไม้ | ใช้ไม้ไป | ขึ้นไม้ | ขึ้นไม้ไป | ท่อน | ชื่อลูกค้า | บันทึก | เช็คเครน | เวรเช็คเครน | ลากยาว | เวรลากยาว | เบรคบ่าย | เวรเบรคบ่าย | รถ | เหลือ | กี่คัน | เช็ครถ | เท่าไร | เท่าไหร่ ;",grammarsizename="#JSGF V1.0; grammar sizename; public <sizename> = 2 min 5 | 2 min 7 | 2 min 8 | 3 min | 3 min 2 | 4 min | 4 min 5 | 5 min | 6 min | 8 min | 9 min | 10 min | 12 min | 15 min | 16 min | 19 min | 20 min | 25 min ;";grammarlist.addFromString(grammarsize,1),grammarlist.addFromString(grammarsizename,1),recognition.grammars=grammarlist,recognition.lang="th-TH",recognition.continuous=!0,recognition.interimResults=!0,recognition.onresult=function(t){let n="";for(let e=t.resultIndex;e<t.results.length;++e)n+=t.results[e][0].transcript;textInput=userInput+n+" ",inputCorrection(),(inputCardContent.textContent=textInput).includes("เอาใหม่")?(textInput="",userInput="",n="",status.textContent="กำลังเริ่มคำสั่งใหม่",setTimeout(()=>{clearCard(),status.textContent="กำลังฟังอยู่...",interactiveSpeech("ว่ามาเลยครับ")},100)):textInput.includes("ยกเลิก")?(textInput="",userInput="",n="",status.textContent="กำลังเริ่มคำสั่งใหม่",setTimeout(()=>{clearCard(),status.textContent="กำลังฟังอยู่...",interactiveSpeech("ยกเลิกแล้วครับ")},100)):textInput.includes("เปลี่ยน")&&setTimeout(()=>{stopListening()},700)},recognition.onerror=function(e){console.error("Speech recognition error:",e.error),e.error},recognition.onend=function(){isListening&&(userInput=textInput,recognition.start())}}else displayCard("F.L.A.T.B.A.R.","บราวเซอร์ไม่รองรับ กรุณาเปิดด้วย Google Chrome."),alert("Your browser doesn't support Speech Recognition.");function startListening(){clearCard(),inputcard.style.display="block",isListening=!0,recognition.start(),status.textContent="กำลังฟังอยู่..."}function stopListening(){isListening=!1,recognition.stop(),userInput=textInput,inputcard.style.display="none",status.textContent="กดที่วิทยุเพื่อพูด",console.log(textInput),getCommand()}function inputCorrection(){var e,t;for([e,t]of Object.entries({"2 min 5":" 2.5 มิล","2 Min 5":" 2.5 มิล","2 มิล 5":" 2.5 มิล","2 มม 5":" 2.5 มิล","2 บิล 5":" 2.5 มิล","2 มิน 5":" 2.5 มิล","2 นิน 5":" 2.5 มิล","2 min 7":" 2.7 มิล","2 Min 7":" 2.7 มิล","2 มิล 7":" 2.7 มิล","2 มม 7":" 2.7 มิล","2 บิล 7":" 2.7 มิล","2 มิน 7":" 2.7 มิล","2 นิน 7":" 2.7 มิล","2 min 8":" 2.8 มิล","2 Min 8":" 2.8 มิล","2 มิล 8":" 2.8 มิล","2 มม 8":" 2.8 มิล","2 บิล 8":" 2.8 มิล","2 มิน 8":" 2.8 มิล","2 นิน 8":" 2.8 มิล","3 min 2":" 3.2 มิล","3 Min 2":" 3.2 มิล","3 มิล 2":" 3.2 มิล","3 มม 2":" 3.2 มิล","3 บิล 2":" 3.2 มิล","3 มิน 2":" 3.2 มิล","4 min 5":" 4.5 มิล","4 Min 5":" 4.5 มิล","4 มิล 5":" 4.5 มิล","4 มม 5":" 4.5 มิล","4 บิล 5":" 4.5 มิล","4 มิน 5":" 4.5 มิล","4 นิน 5":" 4.5 มิล",min:"มิล",Min:"มิล","มิลหน้า":"มิล หน้า","มมหน้า":"มิล หน้า","มม":"มิล","บิล":"มิล","มิน":"มิล","นิน":"มิล"}))textInput=textInput.replace(e,t)}function getCommand(){var e=textInput.includes("ทะเบียน");let t=!1;var o=textInput.includes("เอาอะไร"),n=textInput.includes("ขึ้นอะไร"),i=((o||n)&&(t=!0),textInput.includes("คือใคร")),s=textInput.includes("เป็นใคร");let c=!1;var r=textInput.includes("รถลูกค้า"),a=textInput.includes("รถร่วม"),l=textInput.includes("รถบริษัท"),d=((r||a||l)&&(c=!0,console.log(c)),textInput.includes("ท่อน")),u=textInput.includes("ชื่อลูกค้า"),p=textInput.includes("น้ำหนัก"),m=textInput.includes("กิโล"),h=textInput.includes("จำนวน"),g=textInput.includes("เส้น"),f=textInput.includes("เช็คเครน");let x=!1;var C=textInput.includes("ลากยาว"),I=textInput.includes("เบรคบ่าย");(C||I)&&(x=!0,console.log("คำสั่งหาเวรลากยาว"));let v=!1;C=textInput.includes("เช็ครถ"),I=textInput.includes("เหลือกี่คัน");if((C||I)&&(v=!0),e&&!t&&!c&&!d){console.log("Start TruckNo");var y=textInput.split(/\s+/);for(const b of["ทะเบียน"]){var S=y.findIndex(e=>e.toLowerCase()===b.toLowerCase());if(0<=S){S=y[S+1],displayCard("F.L.A.T.B.A.R",sentence="ทะเบียน "+S+" ต้องการข้อมูลอะไรครับ"),interactiveSpeech(sentence),console.log(S);break}}}if(e&&t){console.log("คำสั่งหารายการ");let e="";if(o?e=textInput.match(/ทะเบียน(.*?)เอาอะไร/):n&&(e=textInput.match(/ทะเบียน(.*?)ขึ้นอะไร/)),console.log(e),e&&e[1])return void needListProcess(e[1])}if(e&&d&&!c)displayCard("F.L.A.T.B.A.R",sentence="กรุณาระบุประเภทรถขนส่งด้วยครับ"),interactiveSpeech(sentence);else{if(e&&c&&d){let e="",t=(r?e="รถลูกค้า":a?e="รถร่วม":l&&(e="รถบริษัท"),0),n="";var L=textInput.replace("ชื่อลูกค้า"," ชื่อลูกค้า ").split(/\s+/);for(const E of["ท่อน"]){var A=L.findIndex(e=>e.toLowerCase()===E.toLowerCase());if(0<A){t=L[A-1],console.log(e," จำนวนไม้: ",L[A-1]," ท่อน");break}}for(const k of["ทะเบียน","รถบริษัททะเบียน","รถร่วมทะเบียน","รถลูกค้าทะเบียน"]){var T=L.findIndex(e=>e.toLowerCase()===k.toLowerCase());if(0<=T){n=L[T+1],console.log("ทะเบียน : ",n);break}}return u?(o=textInput.replace("ชื่อลูกค้า","ชื่อลูกค้า ").match(/ชื่อลูกค้า\s+(\S+)/),textInput.includes("บันทึก")?(displayCard("บันทึกการใช้ไม้",sentence=e+" ทะเบียน "+n+" ใช้ไม้ไป "+t+" ท่อน ชื่อลูกค้า "+o[1]+" ทำการบันทึกแล้วครับ"),saveWoodMemo(e,n,o[1],t),interactiveSpeech("ทำการบันทึกแล้วครับ."),void(textInput="")):(displayCard("บันทึกการใช้ไม้",sentence=e+" ทะเบียน "+n+" ใช้ไม้ไป "+t+" ท่อน ชื่อลูกค้า "+o[1]+" ทำการบันทึกไหมครับ?"),void interactiveSpeech("ทำการบันทึกไหมครับ?"))):textInput.includes("บันทึก")?(displayCard("F.L.A.T.B.A.R",sentence=e+" ทะเบียน "+n+" ใช้ไม้ไป "+t+" ท่อน ทำการบันทึกแล้วครับ"),saveWoodMemo(e,n,"",t),interactiveSpeech("ทำการบันทึกแล้วครับ."),void(textInput="")):(displayCard("F.L.A.T.B.A.R",sentence="ต้องการบันทึกโดยไม่ระบุชื่อลูกค้าหรือไม่?."),void interactiveSpeech(sentence))}if(i||s)console.log("Introduce start"),displayCard("F.L.A.T.B.A.R",sentence="ผมคือโปรแกรมผู้ช่วยของส่วนงานเหล็กแบนชื่อว่า 'แฟลตบาร์'  มีหน้าที่ช่วยงานของคุณให้ง่ายขึ้นด้วยคำสั่งเสียง แต่ในตอนนี้ยังขาดความแม่นยำซึ่งผมจะพยายามปรับปรุงอยู่ครับ"),interactiveSpeech(sentence),textInput="";else if(f&&craneCheckList(),x&&secondShiftList(),e||t||i||s||c||d||u||p||m||f||x||h||g||C||I)p&&m&&console.log("พบข้อมูลน้ำหนัก"),h&&g&&console.log("พบข้อมูลจำนวน"),v&&(console.log("พบคำสั่งเช็ครถ"),interactiveSpeech("กำลังเปิดหน้าเช็ครถครับ"),window.open("http://192.168.2.22/wms/Report/Tracking","_blank"));else{let e="";n=Math.floor(3*Math.random());switch(console.log(n),n){case 0:e="ต้องการให้ช่วยอะไรครับ",console.log(e);break;case 1:e="มีอะไรให้รับใช้ครับ",console.log(e);break;default:e="แฟลตบาร์ยินดีรับใช้ครับ",console.log(e)}displayCard("F.L.A.T.B.A.R",e),void interactiveSpeech(e)}}}function needListProcess(t){console.log("start process"+t);let n=[];fetch("https://sheets.googleapis.com/v4/spreadsheets/1Ia10xULe8AHMKDQGfidlf9eBdi0RUtZe4OQlFeF_ELY/values/Shipment for AI!A:E?key=AIzaSyAFnyXSAki4LiczKNhyEzbhHsvTC-abfAo").then(e=>e.json()).then(e=>{var e=(n=e.values).filter(e=>e[0]&&e[0].toString().toLowerCase().includes(t.trim().toLowerCase()));console.log("start filter"+t.toLowerCase()),console.log("start filter"+e);const i=document.querySelector("#dataTable tbody");i.innerHTML="",e.forEach(t=>{var n=document.createElement("tr");for(let e=1;e<5;e++){var o=document.createElement("td");o.textContent=t[e]||"",n.appendChild(o)}i.appendChild(n)}),document.getElementById("dataTable").style.display="block",displayCard("รายการสินค้าสำหรับทะเบียน "+t),0===e.length?(e="ไม่พบรายการสินค้าสำหรับทะเบียน "+t,cardTitle.textContent="ไม่พบข้อมูล",cardContent.textContent=e,displayCard(),interactiveSpeech(e)):interactiveSpeech("ทะเบียน "+t+" มีรายการสินค้าตามนี้.")}).catch(e=>{console.error("Error fetching data:",e)})}function weightProcess(){const match=textInput.match(/น้ำหนัก(.*?)กิโล/);if(match&&match[1]){const mathText=match[1].trim(),cleanExpr=mathText.replace(/[^0-9+\-*/.]/g,"");try{const sum=eval(cleanExpr);console.log("รวม:",sum),sentence="น้ำหนักเท่ากับ = "+sum+" กิโล",displayCard("("+cleanExpr+") ",sentence+"กรัม"),interactiveSpeech(sentence+".")}catch(err){console.error("ไม่สามารถคำนวณได้:",err)}}else console.log("ไม่พบรูปแบบน้ำหนักที่ถูกต้อง")}function quantityProcess(){const match=textInput.match(/จำนวน(.*?)เส้น/);if(match&&match[1]){const mathText=match[1].trim(),cleanExpr=mathText.replace(/[^0-9+\-*/.]/g,"");try{const sum=eval(cleanExpr);console.log("จำนวน:",sum),sentence="จำนวนเท่ากับ = "+sum+" เส้น",displayCard("("+cleanExpr+") ",sentence),interactiveSpeech(sentence+".")}catch(err){console.error("ไม่สามารถคำนวณได้:",err)}}else console.log("ไม่พบรูปแบบจำนวนที่ถูกต้อง")}function craneCheckList(){console.log("start craneCheckList");let n;fetch("https://sheets.googleapis.com/v4/spreadsheets/1dGGGnSM23HxEChvN9A_LfbKrTVzPV30_ZBfRSt3ve9g/values/ตารางเวรเหล็กแบน!A3:G3?key=AIzaSyAFnyXSAki4LiczKNhyEzbhHsvTC-abfAo").then(e=>e.json()).then(e=>{var e=(n=e.values)[0],t="เวรเช็คเครนของวันที่ "+e[0];displayCard(t,"เครน K2,K4 เวร "+e[5]+" และ "+e[6]+".   เครน K5,K8 เวร "+e[3]+" และ "+e[4]+".    เครน K9,K10 เวร "+e[1]+" และ "+e[2]+"."),interactiveSpeech(t)})}function secondShiftList(){console.log("start secondShiftList");let n;fetch("https://sheets.googleapis.com/v4/spreadsheets/1dGGGnSM23HxEChvN9A_LfbKrTVzPV30_ZBfRSt3ve9g/values/ตารางเวรเหล็กแบน!A6:H6?key=AIzaSyAFnyXSAki4LiczKNhyEzbhHsvTC-abfAo").then(e=>e.json()).then(e=>{var e=(n=e.values)[0],t="เวรลากยาวของวันที่ "+e[0];displayCard(t,"เช็คเกอร์ "+e[1]+" และ "+e[2]+". Operator มี "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]),interactiveSpeech(t)})}function saveWoodMemo(e,t,n,o){var i="";i+="https://docs.google.com/forms/d/e/1FAIpQLSfRIk4d3QxWchVrmBwDBzd_N9Aw9nyynW7iNXTQpOGrf0TmfA/formResponse?entry.1884278026="+t+"&entry.773222215="+e+"&entry.1554877634="+n+"&entry.1601287085="+o,document.createElement("img").src=i}function interactiveSpeech(e){e=new SpeechSynthesisUtterance(e);e.lang="th-TH",e.rate=.9,speechSynthesis.speak(e)}function displayCard(e,t){cardTitle.textContent=e,cardContent.textContent=t,infoCard.style.display="block"}function clearCard(){cardTitle.textContent="",cardContent.textContent="",infoCard.style.display="none",document.getElementById("dataTable").style.display="none"}orb.addEventListener("click",()=>{(isListening?stopListening:startListening)()});</script></body></html>
